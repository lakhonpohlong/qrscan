<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        #reader {
            width: 500px;
            margin: auto;
        }

        #qr-result {
            font-size: 18px;
            font-weight: bold;
        }

        button {
            padding: 10px 20px;
            margin-top: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>QR Code Scanner v1.6</h1>
    <div id="reader"></div>
    <p id="qr-result">Scanned QR: None</p>
    <button id="toggle-btn">Start Camera</button>
    <button id="torch-btn">Toggle Flashlight</button>

    <script>
        let scanner;
        let cameraOn = false;

        async function getCameraStream() {
            try {
                let stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1920 },
                        height: { ideal: 1080 },
                        focusMode: "continuous", // Enables autofocus
                        facingMode: "environment"
                    }
                });

                return stream;
            } catch (err) {
                console.error("Error accessing camera:", err);
            }
        }

        async function startScannerddd() {
            let stream = await getCameraStream();

            if (stream) {
                scanner = new Html5Qrcode("reader", {
                    fps: 20,
                    qrbox: { width: 400, height: 400 },
                    aspectRatio: 2, // Helps with autofocus
                    supportedFormats: [Html5QrcodeSupportedFormats.QR_CODE]
                });

                scanner.start(
                    stream.getVideoTracks()[0], // Pass the camera video track
                    {}, // No extra parameters needed
                    decodedText => {
                        document.getElementById("qr-result").textContent = `ðŸ“Œ Scanned QR: ${decodedText}`;
                    },
                    error => console.warn(`Scan error: ${error}`)
                );
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            document.getElementById("qr-result").textContent = `ðŸ“Œ Scanned QR: ${decodedText}`;
        }

        function onScanFailure(error) {
            console.warn(`Scan error: ${error}`);
        }

        async function startScanner() {
            let scanner = new Html5Qrcode("reader", {
                fps: 20,
                qrbox: { width: 400, height: 400 },
                aspectRatio: 2, // Helps with autofocus
                supportedFormats: [Html5QrcodeSupportedFormats.QR_CODE]
            });

            try {
                let devices = await Html5Qrcode.getCameras(); // Get available cameras
                if (devices.length > 0) {
                    let cameraId = devices[1].id; // Choose the first camera
                    scanner.start(cameraId, {}, onScanSuccess, onScanFailure);
                } else {
                    console.error("No cameras found!");
                }
            } catch (err) {
                console.error("Camera access error:", err);
            }
        }


        function toggleTorch() {
            if (scanner) {
                scanner.applyTorch(cameraOn); // Toggle flashlight
            }
        }

        document.getElementById("toggle-btn").addEventListener("click", startScanner);
        document.getElementById("torch-btn").addEventListener("click", toggleTorch);
    </script>
</body>

</html>